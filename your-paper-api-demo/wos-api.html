<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A layout example that shows off a responsive email layout.">    <title>Email &ndash; Layout Examples &ndash; Pure</title>    
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-" crossorigin="anonymous">
    
    
    
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="css/layouts/demo-old-ie.css">
        <![endif]-->
        <!--[if gt IE 8]><!-->
            <link rel="stylesheet" href="css/layouts/email.css">
        <!--<![endif]-->
</head>
<body>

<div id="layout" class="content pure-g">
    <div id="nav" class="pure-u">
        <a href="#" class="nav-menu-button">Menu</a>

        <div class="nav-inner">
            <button class="primary-button pure-button">도움말</button>

            <div class="pure-menu">
                <ul class="pure-menu-list">
                    <li class="pure-menu-item"><a href="/member-api.html" class="pure-menu-link">멤버 API</a></li>
                    <li class="pure-menu-item"><a href="/paper-api.html" class="pure-menu-link">페이퍼 API</a></li>
                    <li class="pure-menu-item"><a href="/wos-api.html" class="pure-menu-link">WOS 검색 API</a></li>
                    <li class="pure-menu-heading">메모</li>
                    <li class="pure-menu-item"><a href="#" class="pure-menu-link"><span class="demo-label-personal"></span>노랑</a></li>
                    <li class="pure-menu-item"><a href="#" class="pure-menu-link"><span class="demo-label-work"></span>초록</a></li>
                    <li class="pure-menu-item"><a href="#" class="pure-menu-link"><span class="demo-label-travel"></span>파랑</a></li>
                </ul>
            </div>
        </div>
    </div>


    <div id="main" class="pure-u">
        <div class="demo-content">
            <div class="demo-content-header pure-g">
                <div class="pure-u">
                    <h1 class="demo-content-title">WOS 검색 API</h1>
                    <p class="demo-content-subtitle">
                        From <a>김승신</a> at <span>3:10pm, Oct 20, 2019</span>
                    </p>
                </div>

                <div class="demo-content-controls pure-u">
                    <!-- <button class="secondary-button pure-button">Reply</button>
                    <button class="secondary-button pure-button">Forward</button>
                    <button class="secondary-button pure-button">Move to</button> -->
                </div>
            </div>
            
            <div class="demo-content-body">
                <form id="queryForm" class="pure-form">
                    <fieldset>
                        <legend>검색 폼</legend>
                        <select name="category" id="state">
                            <option value="TI">제목</option>
                            <option value="AU">저자</option>
                            <option value="DO">DOI</option>
                        </select>
                        <input id="query" type="text" placeholder="검색어"> <br/>
                        <input id="begin" type="text" placeholder="시작일 yyyy-mm-dd">
                        <input id="end" type="text" placeholder="끝일 yyyy-mm-dd">
                
                        <button type="button" class="pure-button pure-button-primary" onclick="onQuery()">검색</button>
                    </fieldset>
                </form>
                <div>결과</div>
                <hr/>
                <table id="contentTable" class="pure-table">
                </table>
            </t>
        </div>
    </div>
</div>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="./api/wos-api.js"></script>

<script>
    // 검색 클라이언트
    const searchClient = new WokSearchClient();
    
    function onQuery() {
        const queryForm = document.getElementById("queryForm");
        
        const category      = queryForm['category'].value;
        const query         = queryForm['query'].value;
        const begin         = queryForm['begin'].value;
        const end           = queryForm['end'].value;
        const organizations = [];

        if (query.length < 4) {
            return alert("검색어가 너무 짧습니다.");
        }
        if (!(new Date(begin))) {
            return alert("시작 날짜가 비정상적입니다.");
        }
        if (!(new Date(end))) {
            return alert("끝 날짜가 비정상적입니다.");
        }


        // 이제부터 검색 클라이언트 이벤트 처리 정의
        // 페이지 사이즈를 조정할 수 있음.
        searchClient.setPageSize(50);

        /* 1. 인풋 값을 userQuery로 변형하기 */
        console.log('최초 검색 프로세스 :');
        const userQuery = searchClient.buildUserQuery(category, query, organizations);
        // const organizations = ['Sejong Univ'];

        // 2. 검색 시작
        searchClient.search(userQuery, begin, end).then((records) => {
                /* 출력하기 */
                console.log('출력 단계');
                const table = document.getElementById('contentTable');

                let html = `<tr><th>제목</th><th>저자</th><th>링크</th><th>제목</th><th>제목</th><th>제목</th><th>제목</th><tr>`;
                records.forEach(record => {
                    console.log(record);
                    const tr = `<tr><td>${JSON.stringify(record)}</td></tr>`;
                    html += `<tr>
                        <th>${record['title']}</th>
                        <th>${record['authors']}</th>
                        <th><a href="${record['sourceUrl']}">링크</a></th>
                        <th>제목</th><th>제목</th><th>제목</th><th>제목</th><tr>`;
                });
                table.innerHTML = html;
                
            }).catch((error) => {
                console.log('Search, if error :');
                console.log(error);
                searchClient.setLoading(false);
            });
    }
</script>


<script src="https://yui-s.yahooapis.com/3.18.1/build/yui/yui-min.js"></script><script>
    YUI().use('node-base', 'node-event-delegate', function (Y) {
        var menuButton = Y.one('.nav-menu-button'),
            nav        = Y.one('#nav');
        menuButton.on('click', function (e) {
            nav.toggleClass('active');
        });
    });
</script>
</body>
</html>