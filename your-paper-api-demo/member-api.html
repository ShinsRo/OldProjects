<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A layout example that shows off a responsive email layout.">    <title>멤버 API!</title>    
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-" crossorigin="anonymous">
    
    
    
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="css/layouts/demo-old-ie.css">
        <![endif]-->
        <!--[if gt IE 8]><!-->
            <link rel="stylesheet" href="css/layouts/email.css">
        <!--<![endif]-->
</head>
<body>

<div id="layout" class="content pure-g">
    <div id="nav" class="pure-u">
        <a href="#" class="nav-menu-button">Menu</a>

        <div class="nav-inner">
            <button class="primary-button pure-button">도움말</button>

            <div class="pure-menu">
                <ul class="pure-menu-list">
                    <li class="pure-menu-item"><a href="/member-api.html" class="pure-menu-link">멤버 API</a></li>
                    <li class="pure-menu-item"><a href="/paper-api.html" class="pure-menu-link">페이퍼 API</a></li>
                    <li class="pure-menu-item"><a href="/wos-api.html" class="pure-menu-link">WOS 검색 API</a></li>
                    <li class="pure-menu-heading">메모</li>
                    <li class="pure-menu-item"><a href="#" class="pure-menu-link"><span class="demo-label-personal"></span>노랑</a></li>
                    <li class="pure-menu-item"><a href="#" class="pure-menu-link"><span class="demo-label-work"></span>초록</a></li>
                    <li class="pure-menu-item"><a href="#" class="pure-menu-link"><span class="demo-label-travel"></span>파랑</a></li>
                </ul>
            </div>
        </div>
    </div>


    <div id="main" class="pure-u-1">
        <div class="demo-content">
            <div class="demo-content-header pure-g">
                <div class="pure-u-1-2">
                    <h1 class="demo-content-title">API 제목</h1>
                    <p class="demo-content-subtitle">
                        From <a>김승신</a> at <span>3:10pm, Oct 20, 2019</span>
                    </p>
                </div>

                <div class="demo-content-controls pure-u-1-2">
                    <!-- <button class="secondary-button pure-button">Reply</button>
                    <button class="secondary-button pure-button">Forward</button>
                    <button class="secondary-button pure-button">Move to</button> -->
                </div>
            </div>

            <div class="demo-content-body">
                <label>회원가입</label>
                <form id="registerForm" name="login">
                    <input type="text" name="username"/> 아이디 <button onclick="availableCheck(event);">중복확인</button><br/>
                    <input type="text" name="password"/> 비밀번호<br/>
                    <input type="text" name="passwordConfirm"/> 비밀번호 확인<br/>
                    <input type="text" name="name"/> 이름<br/>
                    <input type="text" name="authorNameList"/> 논문 상 영문 이름 1<br/>
                    <input type="text" name="authorNameList"/> 논문 상 영문 이름 2<br/>
                    <select type="text" name="organizationList">
                            <option value="Sejong Univ">세종대학교</option>
                            <option value="Konkuk Univ">건국대학교</option>
                    </select> 연관 기관<br/>
                    <button onclick="register(event);">회원가입</button>
                </form>
                <hr/>
                <label>로그인</label>
                <form id="loginForm" name="login">
                    아이디 : <input type="text" name="login_username"/><br/>
                    비밀번호 : <input type="text" name="login_password"/><br/>
                    <button onclick="memberLogin(event);">로그인</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script src="https://yui-s.yahooapis.com/3.18.1/build/yui/yui-min.js"></script><script>
    YUI().use('node-base', 'node-event-delegate', function (Y) {
        var menuButton = Y.one('.nav-menu-button'),
            nav        = Y.one('#nav');
        menuButton.on('click', function (e) {
            nav.toggleClass('active');
        });
    });
</script>

<script>
    const SERVER_URL = 'http://localhost:9401'

    // 중복확인
    function availableCheck(event) {
        event.preventDefault();
        const registerForm = document.getElementById('registerForm')
        
        const data = {
            'username': registerForm['username'].value
        }
        axios.post(`${SERVER_URL}/auth/availableCheck`, data).then(response => {
            console.log(response);
            
            if (response.data) {
                alert('사용 가능한 아이디.')
            } else {
                alert('이미 존재하는 아이디.')
            }
        }).catch(error => {
            alert('중복 확인 중 에러.')
        })
    }

    // 회원가입
    function register(event) {
        event.preventDefault();
        const registerForm = document.getElementById('registerForm')
        const authorNameList = Array.prototype.slice.call(registerForm['authorNameList']);
        
        const data = {
            'username': registerForm['username'].value,
            'password': registerForm['password'].value,
            'memberInfoDto': {
                'name': registerForm['name'].value,
                'authorNameList': authorNameList.map(e => e.value),
                'organizationList': [registerForm['organizationList'].value], // 필드가 하나일 경우 배열로 만들어서 전달해야함
            }
        }

        axios.post(`${SERVER_URL}/auth/register`, data).then(response => {
            alert('registered')
            // location.href = '/login'
        }).catch(error => {
            console.log(error);
            alert('errored')
        })
    }

    // 로그인
    function memberLogin(event) {
        alert("login")

        event.preventDefault();
        const loginForm = document.getElementById('loginForm')
        const username = loginForm['login_username'].value
        const password = loginForm['login_password'].value
        const data = {
            'username': username,
            'password': password
        }
        console.log(username, password);
        const headers = {
            'Content-Type': 'application/json',
            'Authorization': `Basic ${btoa(`${username}:${password}`)}`
        }
        console.log(headers);
        
        axios.post(`${SERVER_URL}/auth/login`, data, { headers: headers }).then(response => {
            alert('logined')
            console.log(response);
            // location.href = '/main'
        }).catch(error => {
            console.log(error);
            
            alert('errored')
        })
    }

    (function () {
    })();
</script>

</body>
</html>